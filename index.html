<!DOCTYPE html>
<html lang="id" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WARONG ACEH SIGAM BAKONG - Kasir Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .light body {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }

        .dark body {
            background: #0f172a;
        }

        @media print {
            .no-print { display: none; }
            #receipt-print { display: block !important; }
        }
        #receipt-print { display: none; }

        .premium-card {
            border: 1px solid rgba(255, 255, 255, 0.7);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .dark .premium-card {
            background: #1e293b;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        }

        .glass-nav {
            background: rgba(4, 120, 87, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .premium-input {
            background: #ffffff;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .dark .premium-input {
            background: #334155;
            border-color: #475569;
            color: white;
        }

        .premium-input:focus {
            border-color: #10b981;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        }
    </style>
</head>
<body class="min-h-screen text-slate-800 dark:text-slate-200" onload="renderInventory(); renderReports();">

    <nav class="glass-nav text-white p-4 shadow-2xl sticky top-0 z-50 border-b border-emerald-800">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 bg-white rounded-xl flex items-center justify-center text-emerald-700 font-black text-xl">WB</div>
                <div>
                    <h1 class="text-xl md:text-2xl font-extrabold tracking-tighter leading-none uppercase">WARONG ACEH</h1>
                    <p class="text-[10px] font-bold text-emerald-300 tracking-[0.2em] uppercase">Sigam Bakong Kasir Pro</p>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <button onclick="toggleDarkMode()" class="p-2 rounded-xl bg-emerald-900/40 border border-emerald-600/30 hover:bg-emerald-600 transition-all" id="theme-toggle">
                    <span id="theme-icon">üåô</span>
                </button>
                <div class="hidden md:flex bg-emerald-900/30 p-1 rounded-2xl border border-emerald-600/30 font-bold uppercase text-xs">
                    <button onclick="switchTab('kasir')" class="px-6 py-2 hover:bg-emerald-600 rounded-xl transition-all">Kasir</button>
                    <button onclick="switchTab('stok')" class="px-6 py-2 hover:bg-emerald-600 rounded-xl transition-all">Stok</button>
                    <button onclick="switchTab('laporan')" class="px-6 py-2 hover:bg-emerald-600 rounded-xl transition-all">Laporan</button>
                </div>
            </div>
        </div>
    </nav>

    <main class="container mx-auto p-4 md:p-8">
        <!-- KASIR -->
        <section id="tab-kasir" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 space-y-6">
                    <div class="bg-white dark:bg-slate-800 p-8 rounded-[2rem] premium-card">
                        <h2 class="text-lg font-bold uppercase mb-4">Input Penjualan</h2>
                        <input type="text" id="barcode-scanner" placeholder="Scan Barcode..." class="w-full premium-input p-5 rounded-2xl outline-none text-xl font-semibold" autofocus>
                    </div>

                    <div class="bg-white dark:bg-slate-800 rounded-[2.5rem] premium-card overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 dark:bg-slate-900/50 text-slate-400 text-[11px] font-extrabold uppercase">
                                <tr>
                                    <th class="p-6">Produk</th>
                                    <th class="p-6">Harga Jual</th>
                                    <th class="p-6">Qty</th>
                                    <th class="p-6">Total</th>
                                    <th class="p-6 text-right">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="cart-items" class="divide-y divide-slate-100 dark:divide-slate-700"></tbody>
                        </table>
                    </div>
                </div>

                <div class="space-y-6">
                    <div class="bg-slate-900 p-8 rounded-[2.5rem] text-white">
                        <h2 class="text-emerald-500 text-xs font-black uppercase mb-4">Total Bayar</h2>
                        <div class="text-5xl font-extrabold mb-8" id="grand-total">Rp 0</div>
                        <input type="number" id="cash-input" class="w-full bg-slate-800 p-5 text-2xl rounded-2xl mb-4 text-white outline-none focus:ring-2 ring-emerald-500" placeholder="Uang Tunai">
                        <div id="change-amount" class="text-xl font-bold mb-6 text-emerald-400">Kembali: Rp 0</div>
                        <button onclick="processTransaction()" class="w-full bg-emerald-500 text-emerald-950 py-6 rounded-2xl font-black text-lg uppercase transition-transform active:scale-95 shadow-xl shadow-emerald-500/20">PROSES TRANSAKSI</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- STOK -->
        <section id="tab-stok" class="tab-content hidden">
            <div class="bg-white dark:bg-slate-800 p-8 rounded-[2rem] premium-card mb-8">
                <h2 class="text-xl font-bold mb-6">Tambah / Update Master Stok</h2>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase">Barcode</label>
                        <input type="text" id="new-barcode" class="w-full premium-input p-3 rounded-xl">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase">Nama Barang</label>
                        <input type="text" id="new-name" class="w-full premium-input p-3 rounded-xl">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase">Harga Modal</label>
                        <input type="number" id="new-cost" class="w-full premium-input p-3 rounded-xl" placeholder="Beli">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase">Harga Jual</label>
                        <input type="number" id="new-price" class="w-full premium-input p-3 rounded-xl" placeholder="Jual">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase">Stok Awal</label>
                        <input type="number" id="new-stock" class="w-full premium-input p-3 rounded-xl">
                    </div>
                </div>
                <button onclick="addStockItem()" class="bg-emerald-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-emerald-500 transition shadow-lg shadow-emerald-500/20">Simpan ke Inventori</button>
            </div>

            <div class="bg-white dark:bg-slate-800 rounded-[2rem] premium-card overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 dark:bg-slate-900/50 text-slate-400 text-[11px] font-extrabold uppercase">
                            <tr>
                                <th class="p-6">Barcode</th>
                                <th class="p-6">Nama Produk</th>
                                <th class="p-6">Harga Modal</th>
                                <th class="p-6">Harga Jual</th>
                                <th class="p-6">Laba/Unit</th>
                                <th class="p-6">Stok</th>
                                <th class="p-6 text-center">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-list" class="divide-y divide-slate-100 dark:divide-slate-700"></tbody>
                    </table>
                </div>
            </div>
        </section>
        
        <!-- LAPORAN -->
        <section id="tab-laporan" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="bg-white dark:bg-slate-800 p-8 rounded-[2rem] premium-card border-l-4 border-emerald-500">
                    <h3 class="text-xs font-bold text-slate-400 uppercase mb-2">Total Penjualan (Omzet)</h3>
                    <div class="text-3xl font-black text-emerald-600" id="report-total-omzet">Rp 0</div>
                </div>
                <div class="bg-white dark:bg-slate-800 p-8 rounded-[2rem] premium-card border-l-4 border-blue-500">
                    <h3 class="text-xs font-bold text-slate-400 uppercase mb-2">Total Laba Bersih</h3>
                    <div class="text-3xl font-black text-blue-600" id="report-total-profit">Rp 0</div>
                </div>
            </div>

            <div class="bg-white dark:bg-slate-800 p-8 rounded-[2rem] premium-card">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold uppercase">Riwayat Penjualan</h2>
                    <button onclick="clearHistory()" class="text-xs text-red-500 font-bold hover:bg-red-50 p-2 rounded-lg transition uppercase">Hapus Riwayat</button>
                </div>
                <div class="overflow-hidden rounded-xl border dark:border-slate-700">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 dark:bg-slate-900/50 text-slate-400 text-[10px] font-bold uppercase">
                            <tr>
                                <th class="p-4">Waktu</th>
                                <th class="p-4">Item</th>
                                <th class="p-4">Total</th>
                                <th class="p-4">Laba</th>
                            </tr>
                        </thead>
                        <tbody id="report-list" class="divide-y divide-slate-100 dark:divide-slate-700"></tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal Struk -->
    <div id="receipt-modal" class="fixed inset-0 bg-slate-900/90 backdrop-blur-md hidden flex items-center justify-center p-4 z-[100]">
        <div class="bg-white w-full max-w-sm rounded-[2.5rem] p-8 shadow-2xl">
            <div id="receipt-content" class="text-[11px] font-mono text-slate-800 leading-relaxed bg-white p-2">
                <div class="text-center font-black text-sm mb-4 uppercase">WARONG ACEH SIGAM BAKONG</div>
                <div class="text-center mb-4 border-b pb-2 text-[9px] text-slate-500 font-bold" id="receipt-date-time"></div>
                <div id="receipt-details" class="space-y-1 mb-4"></div>
                <div class="border-t-2 border-dashed pt-4 text-right font-black text-xs" id="receipt-totals"></div>
                <div class="text-center mt-6 italic text-[8px] text-slate-400">Terima Kasih Atas Kunjungan Anda</div>
            </div>
            <div class="mt-6 flex flex-col gap-2">
                <button onclick="window.print()" class="bg-emerald-600 text-white py-4 rounded-xl font-bold shadow-lg shadow-emerald-500/30 flex items-center justify-center gap-2">
                    <span>üñ®Ô∏è</span> CETAK STRUK / PDF
                </button>
                <button onclick="closeReceipt()" class="text-slate-400 py-2 text-xs font-bold uppercase text-center mt-2">TUTUP</button>
            </div>
        </div>
    </div>

    <div id="receipt-print"></div>

    <script>
        let inventory = JSON.parse(localStorage.getItem('wb_inv')) || [];
        let transactions = JSON.parse(localStorage.getItem('wb_tx')) || [];
        let cart = [];
        let currentTransaction = null;

        // --- CORE LOGIC ---
        function toggleDarkMode() {
            const html = document.documentElement;
            html.classList.toggle('dark');
            const isDark = html.classList.contains('dark');
            document.getElementById('theme-icon').innerText = isDark ? '‚òÄÔ∏è' : 'üåô';
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        if(localStorage.getItem('theme') === 'dark') {
            document.documentElement.classList.add('dark');
            document.getElementById('theme-icon').innerText = '‚òÄÔ∏è';
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById('tab-' + tab).classList.remove('hidden');
            if(tab === 'stok') renderInventory();
            if(tab === 'laporan') renderReports();
        }

        function addStockItem() {
            const barcode = document.getElementById('new-barcode').value.trim();
            const name = document.getElementById('new-name').value.trim();
            const cost = parseInt(document.getElementById('new-cost').value);
            const price = parseInt(document.getElementById('new-price').value);
            const stock = parseInt(document.getElementById('new-stock').value);

            if(!barcode || !name || isNaN(cost) || isNaN(price) || isNaN(stock)) {
                alert('Mohon isi semua data dengan benar!');
                return;
            }

            const existingIndex = inventory.findIndex(item => item.barcode === barcode);
            const productData = { barcode, name, cost, price, stock };

            if(existingIndex > -1) inventory[existingIndex] = productData;
            else inventory.push(productData);

            localStorage.setItem('wb_inv', JSON.stringify(inventory));
            document.querySelectorAll('#tab-stok input').forEach(i => i.value = '');
            renderInventory();
        }

        function renderInventory() {
            const tbody = document.getElementById('inventory-list');
            if(!tbody) return;
            tbody.innerHTML = '';
            inventory.forEach((item, index) => {
                const profitPerUnit = item.price - item.cost;
                const profitClass = profitPerUnit >= 0 ? 'text-emerald-600' : 'text-red-500';

                tbody.innerHTML += `
                    <tr class="text-sm">
                        <td class="p-6 font-mono text-xs">${item.barcode}</td>
                        <td class="p-6 font-bold uppercase">${item.name}</td>
                        <td class="p-6 text-slate-400">Rp ${item.cost.toLocaleString()}</td>
                        <td class="p-6 font-semibold">Rp ${item.price.toLocaleString()}</td>
                        <td class="p-6 font-bold ${profitClass}">Rp ${profitPerUnit.toLocaleString()}</td>
                        <td class="p-6">
                            <span class="${item.stock < 10 ? 'text-red-500 font-bold' : ''}">${item.stock}</span>
                        </td>
                        <td class="p-6 text-center">
                            <button onclick="deleteItem(${index})" class="text-red-500 hover:underline">Hapus</button>
                        </td>
                    </tr>`;
            });
        }

        function deleteItem(index) {
            if(confirm('Hapus item ini?')) {
                inventory.splice(index, 1);
                localStorage.setItem('wb_inv', JSON.stringify(inventory));
                renderInventory();
            }
        }

        const barcodeInput = document.getElementById('barcode-scanner');
        barcodeInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const code = barcodeInput.value.trim();
                const product = inventory.find(p => p.barcode === code);
                if (product) {
                    if(product.stock <= 0) alert('Stok habis!');
                    else {
                        const existing = cart.find(c => c.barcode === code);
                        if (existing) {
                            if(existing.qty < product.stock) existing.qty++;
                            else alert('Stok tidak mencukupi!');
                        }
                        else cart.push({...product, qty: 1});
                        renderCart();
                    }
                } else {
                    alert('Barang tidak terdaftar di stok!');
                }
                barcodeInput.value = '';
            }
        });

        function renderCart() {
            const tbody = document.getElementById('cart-items');
            tbody.innerHTML = '';
            let total = 0;
            cart.forEach((item, idx) => {
                const sub = item.price * item.qty;
                total += sub;
                tbody.innerHTML += `
                    <tr>
                        <td class="p-6 font-bold uppercase">${item.name}</td>
                        <td class="p-6">Rp ${item.price.toLocaleString()}</td>
                        <td class="p-6">${item.qty}</td>
                        <td class="p-6 font-bold text-emerald-600">Rp ${sub.toLocaleString()}</td>
                        <td class="p-6 text-right"><button onclick="cart.splice(${idx},1);renderCart()" class="text-red-400">Hapus</button></td>
                    </tr>`;
            });
            document.getElementById('grand-total').innerText = `Rp ${total.toLocaleString()}`;
            updateChange();
        }

        function updateChange() {
            const total = cart.reduce((a,b) => a + (b.price*b.qty), 0);
            const cash = parseInt(document.getElementById('cash-input').value) || 0;
            document.getElementById('change-amount').innerText = `Kembali: Rp ${(cash - total >= 0 ? cash - total : 0).toLocaleString()}`;
        }
        document.getElementById('cash-input').addEventListener('input', updateChange);

        function processTransaction() {
            const total = cart.reduce((a,b) => a + (b.price*b.qty), 0);
            const totalCost = cart.reduce((a,b) => a + (b.cost*b.qty), 0);
            const profit = total - totalCost;
            
            const cash = parseInt(document.getElementById('cash-input').value) || 0;
            if (total === 0) return;
            if (cash < total) { alert('Uang kurang!'); return; }

            const now = new Date();
            const fullDateTime = now.toLocaleDateString('id-ID', { day:'2-digit', month:'2-digit', year:'numeric' }) + ' ' + now.toLocaleTimeString('id-ID', { hour:'2-digit', minute:'2-digit' });

            currentTransaction = { 
                id: 'TX'+Date.now(), 
                time: fullDateTime, 
                items: [...cart], 
                total, 
                totalCost,
                profit,
                cash 
            };
            
            transactions.push(currentTransaction);
            localStorage.setItem('wb_tx', JSON.stringify(transactions));

            cart.forEach(c => {
                const item = inventory.find(i => i.barcode === c.barcode);
                if(item) item.stock -= c.qty;
            });
            localStorage.setItem('wb_inv', JSON.stringify(inventory));

            showReceipt(currentTransaction);
            cart = [];
            document.getElementById('cash-input').value = '';
            renderCart();
            renderReports();
        }

        function showReceipt(tx) {
            document.getElementById('receipt-date-time').innerText = tx.time;
            const details = document.getElementById('receipt-details');
            details.innerHTML = tx.items.map(i => `<div class="flex justify-between"><span>${i.name} x${i.qty}</span><span>Rp ${(i.price*i.qty).toLocaleString()}</span></div>`).join('');
            document.getElementById('receipt-totals').innerHTML = `<div>TOTAL : Rp ${tx.total.toLocaleString()}</div><div>BAYAR : Rp ${tx.cash.toLocaleString()}</div><div>KEMBALI : Rp ${(tx.cash - tx.total).toLocaleString()}</div>`;
            document.getElementById('receipt-print').innerHTML = document.getElementById('receipt-content').innerHTML;
            document.getElementById('receipt-modal').classList.remove('hidden');
        }

        function closeReceipt() { 
            document.getElementById('receipt-modal').classList.add('hidden');
            currentTransaction = null;
        }

        function renderReports() {
            const list = document.getElementById('report-list');
            if(!list) return;
            list.innerHTML = '';
            
            let totalOmzet = 0;
            let totalProfit = 0;

            [...transactions].reverse().forEach(tx => {
                totalOmzet += tx.total;
                totalProfit += (tx.profit || 0);

                list.innerHTML += `
                    <tr class="text-xs">
                        <td class="p-4 whitespace-nowrap">${tx.time}</td>
                        <td class="p-4 truncate max-w-[150px]">${tx.items.map(i => i.name).join(', ')}</td>
                        <td class="p-4 font-bold">Rp ${tx.total.toLocaleString()}</td>
                        <td class="p-4 font-bold ${tx.profit >= 0 ? 'text-emerald-500' : 'text-red-500'}">Rp ${(tx.profit || 0).toLocaleString()}</td>
                    </tr>`;
            });

            document.getElementById('report-total-omzet').innerText = `Rp ${totalOmzet.toLocaleString()}`;
            document.getElementById('report-total-profit').innerText = `Rp ${totalProfit.toLocaleString()}`;
        }

        function clearHistory() {
            if(confirm('Hapus semua riwayat penjualan? Data laba akan hilang!')) {
                transactions = [];
                localStorage.setItem('wb_tx', JSON.stringify(transactions));
                renderReports();
            }
        }
    </script>
</body>
</html>