<!DOCTYPE html>
<html lang="id" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WARONG ACEH SIGAM BAKONG - Kasir Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.3s ease; }
        .light body { background: #f8fafc; }
        .dark body { background: #0f172a; }
        .premium-card { border: 1px solid rgba(226, 232, 240, 0.8); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .dark .premium-card { background: #1e293b; border-color: #334155; }
        .glass-nav { background: #047857; }
        @media print { 
            .no-print { display: none; } 
            #receipt-print { display: block !important; width: 100%; } 
            body { background: white !important; }
        }
        #receipt-print { display: none; }
    </style>
</head>
<body class="min-h-screen text-slate-800 dark:text-slate-200" onload="initApp()">

    <nav class="glass-nav text-white p-4 shadow-xl sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center text-emerald-700 font-bold">WA</div>
                <div>
                    <h1 class="text-lg font-extrabold uppercase leading-none">WARONG ACEH</h1>
                    <p class="text-[10px] text-emerald-200 uppercase font-bold tracking-widest">Sigam Bakong</p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="toggleDarkMode()" class="p-2 bg-emerald-800 rounded-lg">
                    <span id="theme-icon">ðŸŒ™</span>
                </button>
                <div class="flex bg-emerald-900/50 p-1 rounded-lg text-[10px] font-bold uppercase">
                    <button onclick="switchTab('kasir')" class="px-4 py-2 hover:bg-emerald-600 rounded-md transition-all">Kasir</button>
                    <button onclick="switchTab('stok')" class="px-4 py-2 hover:bg-emerald-600 rounded-md transition-all">Stok</button>
                    <button onclick="switchTab('laporan')" class="px-4 py-2 hover:bg-emerald-600 rounded-md transition-all">Laporan</button>
                </div>
            </div>
        </div>
    </nav>

    <main class="container mx-auto p-4 md:p-6 no-print">
        <!-- TAB KASIR -->
        <section id="tab-kasir" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Sisi Kiri: Input & Daftar Barang -->
                <div class="lg:col-span-2 space-y-4">
                    <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl premium-card">
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-2">Scan Barcode / Cari Nama</label>
                        <input type="text" id="barcode-scanner" placeholder="Ketik Barcode atau Nama Produk..." 
                               class="w-full p-4 rounded-xl border-2 border-slate-100 dark:border-slate-700 dark:bg-slate-900 outline-none focus:border-emerald-500 text-lg font-semibold"
                               onkeyup="handleSearch(event)">
                        
                        <div class="mt-4">
                            <p class="text-[9px] font-bold text-slate-400 uppercase mb-2">Pilih Cepat Produk:</p>
                            <div id="quick-select" class="flex flex-wrap gap-2 max-h-32 overflow-y-auto p-1"></div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-slate-800 rounded-2xl premium-card overflow-hidden">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-slate-50 dark:bg-slate-900/50 text-slate-400 text-[10px] font-bold uppercase">
                                <tr>
                                    <th class="p-4">Produk</th>
                                    <th class="p-4">Harga</th>
                                    <th class="p-4">Qty</th>
                                    <th class="p-4">Total</th>
                                    <th class="p-4 text-center">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="cart-items" class="divide-y divide-slate-100 dark:divide-slate-700"></tbody>
                        </table>
                        <div id="empty-cart-msg" class="p-10 text-center text-slate-400 italic text-sm">Keranjang kosong</div>
                    </div>
                </div>

                <!-- Sisi Kanan: Pembayaran -->
                <div class="space-y-4">
                    <div class="bg-slate-900 p-6 rounded-3xl text-white shadow-2xl">
                        <p class="text-emerald-500 text-[10px] font-bold uppercase mb-1">Total Transaksi</p>
                        <div class="text-4xl font-black mb-6" id="grand-total">Rp 0</div>
                        
                        <div class="space-y-3">
                            <div>
                                <label class="text-[10px] text-slate-400 font-bold uppercase">Uang Tunai (Rp)</label>
                                <input type="number" id="cash-input" oninput="calculateChange()"
                                       class="w-full bg-slate-800 p-4 text-xl rounded-xl border border-slate-700 outline-none focus:ring-2 ring-emerald-500" 
                                       placeholder="0">
                            </div>
                            <div class="flex justify-between items-center p-3 bg-slate-800/50 rounded-xl">
                                <span class="text-xs text-slate-400 uppercase font-bold">Kembalian</span>
                                <span class="text-xl font-bold text-emerald-400" id="change-amount">Rp 0</span>
                            </div>
                            <button onclick="processTransaction()" 
                                    class="w-full bg-emerald-500 hover:bg-emerald-400 text-emerald-950 py-5 rounded-2xl font-black text-lg uppercase transition-all transform active:scale-95">
                                Bayar Sekarang
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- TAB STOK -->
        <section id="tab-stok" class="tab-content hidden">
            <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl premium-card mb-6">
                <h2 class="font-bold mb-4 uppercase text-sm">Master Data Barang</h2>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-3">
                    <input type="text" id="new-barcode" placeholder="Barcode/Kode" class="p-3 border rounded-xl dark:bg-slate-900 dark:border-slate-700 text-sm">
                    <input type="text" id="new-name" placeholder="Nama Barang" class="p-3 border rounded-xl dark:bg-slate-900 dark:border-slate-700 text-sm">
                    <input type="number" id="new-cost" placeholder="Harga Modal" class="p-3 border rounded-xl dark:bg-slate-900 dark:border-slate-700 text-sm">
                    <input type="number" id="new-price" placeholder="Harga Jual" class="p-3 border rounded-xl dark:bg-slate-900 dark:border-slate-700 text-sm">
                    <input type="number" id="new-stock" placeholder="Stok" class="p-3 border rounded-xl dark:bg-slate-900 dark:border-slate-700 text-sm">
                </div>
                <button onclick="addStockItem()" class="mt-4 bg-emerald-600 text-white px-6 py-3 rounded-xl font-bold text-sm uppercase">Tambah Barang</button>
            </div>

            <div class="bg-white dark:bg-slate-800 rounded-2xl premium-card overflow-x-auto">
                <table class="w-full text-left text-sm">
                    <thead class="bg-slate-50 dark:bg-slate-900/50 text-slate-400 text-[10px] font-bold uppercase">
                        <tr>
                            <th class="p-4">Barcode</th>
                            <th class="p-4">Nama</th>
                            <th class="p-4 text-center">Beli/Modal</th>
                            <th class="p-4 text-center">Jual</th>
                            <th class="p-4 text-center">Laba</th>
                            <th class="p-4 text-center">Stok</th>
                            <th class="p-4 text-center">Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="inventory-list" class="divide-y divide-slate-100 dark:divide-slate-700"></tbody>
                </table>
            </div>
        </section>

        <!-- TAB LAPORAN -->
        <section id="tab-laporan" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl premium-card border-l-4 border-emerald-500">
                    <p class="text-[10px] font-bold text-slate-400 uppercase">Omzet Penjualan</p>
                    <h3 class="text-2xl font-black text-emerald-600" id="report-omzet">Rp 0</h3>
                </div>
                <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl premium-card border-l-4 border-blue-500">
                    <p class="text-[10px] font-bold text-slate-400 uppercase">Total Laba</p>
                    <h3 class="text-2xl font-black text-blue-600" id="report-laba">Rp 0</h3>
                </div>
            </div>
            <div class="bg-white dark:bg-slate-800 rounded-2xl premium-card p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-bold uppercase text-sm text-slate-500">Riwayat Penjualan</h2>
                    <button onclick="clearHistory()" class="text-xs text-red-500 font-bold uppercase">Reset Data</button>
                </div>
                <div id="report-list" class="space-y-2"></div>
            </div>
        </section>
    </main>

    <!-- Modal Struk -->
    <div id="receipt-modal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm hidden flex items-center justify-center p-4 z-[100] no-print">
        <div class="bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl overflow-hidden">
            <div id="receipt-content" class="text-[10px] font-mono leading-tight text-black p-2 bg-white">
                <div class="text-center font-bold text-sm mb-2">WARONG ACEH SIGAM BAKONG</div>
                <div class="text-center mb-4 border-b border-black pb-2" id="receipt-time"></div>
                <div id="receipt-items" class="space-y-1 border-b border-black pb-2 mb-2"></div>
                <div id="receipt-totals" class="text-right font-bold space-y-1"></div>
                <div class="text-center mt-6 border-t border-black pt-4">
                    <p class="italic text-[9px]">Terimakasih Sudah Belanja DI Warung Kami</p>
                    <p class="italic text-[9px]">Semoga TIDAK KAPOK HA.. HA..</p>
                    <p class="font-bold text-[11px] mt-2 uppercase tracking-tighter">ANDA BUNTUNG KAMI UNTUNG</p>
                </div>
            </div>
            <div class="mt-6 space-y-2">
                <button onclick="window.print()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow-lg">CETAK PDF / PRINTER</button>
                <button onclick="closeReceipt()" class="w-full text-slate-400 py-2 text-xs font-bold uppercase text-center">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Container khusus untuk print agar rapi -->
    <div id="receipt-print" class="bg-white text-black p-4"></div>

    <script>
        let inventory = JSON.parse(localStorage.getItem('wa_inv')) || [];
        let transactions = JSON.parse(localStorage.getItem('wa_tx')) || [];
        let cart = [];

        function initApp() {
            renderInventory();
            renderReports();
            renderQuickSelect();
            focusScanner();
        }

        function focusScanner() {
            const input = document.getElementById('barcode-scanner');
            if(input) input.focus();
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            const target = document.getElementById('tab-' + tab);
            if(target) target.classList.remove('hidden');
            if (tab === 'kasir') {
                renderQuickSelect();
                focusScanner();
            }
        }

        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            const icon = document.documentElement.classList.contains('dark') ? 'â˜€ï¸' : 'ðŸŒ™';
            document.getElementById('theme-icon').innerText = icon;
        }

        function addStockItem() {
            const barcode = document.getElementById('new-barcode').value.trim();
            const name = document.getElementById('new-name').value.trim();
            const cost = parseInt(document.getElementById('new-cost').value) || 0;
            const price = parseInt(document.getElementById('new-price').value) || 0;
            const stock = parseInt(document.getElementById('new-stock').value) || 0;

            if (!barcode || !name || price === 0) return alert('Lengkapi data produk!');

            const idx = inventory.findIndex(i => i.barcode === barcode);
            if (idx > -1) {
                inventory[idx] = { barcode, name, cost, price, stock };
            } else {
                inventory.push({ barcode, name, cost, price, stock });
            }

            localStorage.setItem('wa_inv', JSON.stringify(inventory));
            renderInventory();
            renderQuickSelect();
            document.querySelectorAll('#tab-stok input').forEach(i => i.value = '');
        }

        function renderInventory() {
            const tbody = document.getElementById('inventory-list');
            if(!tbody) return;
            tbody.innerHTML = '';
            inventory.forEach((item, idx) => {
                const profit = item.price - item.cost;
                tbody.innerHTML += `
                    <tr>
                        <td class="p-4 font-mono text-xs">${item.barcode}</td>
                        <td class="p-4 font-bold uppercase">${item.name}</td>
                        <td class="p-4 text-center">Rp ${item.cost.toLocaleString()}</td>
                        <td class="p-4 text-center font-bold">Rp ${item.price.toLocaleString()}</td>
                        <td class="p-4 text-center text-emerald-600 font-bold">Rp ${profit.toLocaleString()}</td>
                        <td class="p-4 text-center font-bold ${item.stock <= 5 ? 'text-red-500' : ''}">${item.stock}</td>
                        <td class="p-4 text-center">
                            <button onclick="deleteStock(${idx})" class="text-red-500 hover:underline">Hapus</button>
                        </td>
                    </tr>
                `;
            });
        }

        function deleteStock(idx) {
            if (confirm('Hapus barang?')) {
                inventory.splice(idx, 1);
                localStorage.setItem('wa_inv', JSON.stringify(inventory));
                renderInventory();
                renderQuickSelect();
            }
        }

        function renderQuickSelect() {
            const container = document.getElementById('quick-select');
            if(!container) return;
            container.innerHTML = '';
            inventory.forEach(item => {
                if (item.stock > 0) {
                    container.innerHTML += `
                        <button onclick="addToCart('${item.barcode}')" 
                                class="px-3 py-2 bg-slate-100 dark:bg-slate-700 hover:bg-emerald-500 hover:text-white rounded-lg text-[10px] font-bold uppercase transition-all">
                            ${item.name} (${item.stock})
                        </button>
                    `;
                }
            });
        }

        function handleSearch(e) {
            if (e.key === 'Enter') {
                const val = e.target.value.trim();
                if (!val) return;
                
                const product = inventory.find(i => i.barcode === val || i.name.toLowerCase() === val.toLowerCase());
                if (product) {
                    addToCart(product.barcode);
                    e.target.value = '';
                } else {
                    alert('Barang tidak ditemukan!');
                }
            }
        }

        function addToCart(barcode) {
            const item = inventory.find(i => i.barcode === barcode);
            if (!item) return;
            if (item.stock <= 0) return alert('Stok Habis!');

            const cartIdx = cart.findIndex(c => c.barcode === barcode);
            if (cartIdx > -1) {
                if (cart[cartIdx].qty < item.stock) {
                    cart[cartIdx].qty++;
                } else {
                    alert('Stok tidak cukup!');
                }
            } else {
                cart.push({ ...item, qty: 1 });
            }

            renderCart();
            focusScanner();
        }

        function updateCartQty(idx, change) {
            const product = inventory.find(i => i.barcode === cart[idx].barcode);
            const newQty = cart[idx].qty + change;
            
            if (newQty <= 0) {
                cart.splice(idx, 1);
            } else if (newQty <= product.stock) {
                cart[idx].qty = newQty;
            } else {
                alert('Stok limit!');
            }
            renderCart();
        }

        function renderCart() {
            const tbody = document.getElementById('cart-items');
            const emptyMsg = document.getElementById('empty-cart-msg');
            if(!tbody) return;
            tbody.innerHTML = '';
            
            if (cart.length === 0) {
                emptyMsg.classList.remove('hidden');
                document.getElementById('grand-total').innerText = 'Rp 0';
                return;
            }
            emptyMsg.classList.add('hidden');

            let total = 0;
            cart.forEach((item, idx) => {
                const sub = item.price * item.qty;
                total += sub;
                tbody.innerHTML += `
                    <tr>
                        <td class="p-4">
                            <div class="font-bold uppercase">${item.name}</div>
                            <div class="text-[9px] text-slate-400 font-mono">${item.barcode}</div>
                        </td>
                        <td class="p-4">Rp ${item.price.toLocaleString()}</td>
                        <td class="p-4">
                            <div class="flex items-center gap-3">
                                <button onclick="updateCartQty(${idx}, -1)" class="w-6 h-6 bg-slate-100 dark:bg-slate-700 rounded-full font-bold text-xs">-</button>
                                <span class="font-bold">${item.qty}</span>
                                <button onclick="updateCartQty(${idx}, 1)" class="w-6 h-6 bg-slate-100 dark:bg-slate-700 rounded-full font-bold text-xs">+</button>
                            </div>
                        </td>
                        <td class="p-4 font-bold text-emerald-600">Rp ${sub.toLocaleString()}</td>
                        <td class="p-4 text-center">
                            <button onclick="cart.splice(${idx},1);renderCart()" class="text-red-400 font-bold">X</button>
                        </td>
                    </tr>
                `;
            });

            document.getElementById('grand-total').innerText = `Rp ${total.toLocaleString()}`;
            calculateChange();
        }

        function calculateChange() {
            const total = cart.reduce((a, b) => a + (b.price * b.qty), 0);
            const cash = parseInt(document.getElementById('cash-input').value) || 0;
            const change = cash - total;
            const changeDisplay = document.getElementById('change-amount');
            if(changeDisplay) changeDisplay.innerText = `Rp ${change >= 0 ? change.toLocaleString() : 0}`;
        }

        function processTransaction() {
            const total = cart.reduce((a, b) => a + (b.price * b.qty), 0);
            const totalCost = cart.reduce((a, b) => a + (b.cost * b.qty), 0);
            const cash = parseInt(document.getElementById('cash-input').value) || 0;

            if (cart.length === 0) return alert('Keranjang kosong!');
            if (cash < total) return alert('Uang tidak cukup!');

            const now = new Date();
            const timeStr = now.toLocaleString('id-ID');
            const profit = total - totalCost;

            const transaction = {
                id: Date.now(),
                time: timeStr,
                items: [...cart],
                total: total,
                totalCost: totalCost,
                profit: profit,
                cash: cash
            };

            transactions.push(transaction);
            localStorage.setItem('wa_tx', JSON.stringify(transactions));

            cart.forEach(c => {
                const idx = inventory.findIndex(i => i.barcode === c.barcode);
                if (idx > -1) inventory[idx].stock -= c.qty;
            });
            localStorage.setItem('wa_inv', JSON.stringify(inventory));

            showReceipt(transaction);

            cart = [];
            document.getElementById('cash-input').value = '';
            renderCart();
            renderReports();
            renderInventory();
            renderQuickSelect();
        }

        function showReceipt(tx) {
            const timeEl = document.getElementById('receipt-time');
            if(timeEl) timeEl.innerText = tx.time;
            
            const itemsContainer = document.getElementById('receipt-items');
            if(itemsContainer) {
                itemsContainer.innerHTML = tx.items.map(i => `
                    <div class="flex justify-between">
                        <span>${i.name} x${i.qty}</span>
                        <span>Rp ${(i.price * i.qty).toLocaleString()}</span>
                    </div>
                `).join('');
            }

            const totalEl = document.getElementById('receipt-totals');
            if(totalEl) {
                totalEl.innerHTML = `
                    <div>TOTAL: Rp ${tx.total.toLocaleString()}</div>
                    <div>BAYAR: Rp ${tx.cash.toLocaleString()}</div>
                    <div>KEMBALI: Rp ${(tx.cash - tx.total).toLocaleString()}</div>
                `;
            }

            const printContainer = document.getElementById('receipt-print');
            if(printContainer) {
                printContainer.innerHTML = document.getElementById('receipt-content').innerHTML;
            }
            
            const modal = document.getElementById('receipt-modal');
            if(modal) modal.classList.remove('hidden');
        }

        function closeReceipt() {
            const modal = document.getElementById('receipt-modal');
            if(modal) modal.classList.add('hidden');
            focusScanner();
        }

        function renderReports() {
            const omzetEl = document.getElementById('report-omzet');
            const labaEl = document.getElementById('report-laba');
            const list = document.getElementById('report-list');
            if(!list) return;

            let totalOmzet = 0;
            let totalLaba = 0;

            list.innerHTML = '';
            [...transactions].reverse().forEach(tx => {
                totalOmzet += tx.total;
                totalLaba += tx.profit;

                list.innerHTML += `
                    <div class="flex justify-between items-center p-3 border rounded-xl text-xs">
                        <div>
                            <div class="font-bold">${tx.time}</div>
                            <div class="text-[10px] text-slate-400">${tx.items.map(i => i.name).join(', ')}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold">Rp ${tx.total.toLocaleString()}</div>
                            <div class="text-emerald-500 font-bold">Laba: Rp ${tx.profit.toLocaleString()}</div>
                        </div>
                    </div>
                `;
            });

            if(omzetEl) omzetEl.innerText = `Rp ${totalOmzet.toLocaleString()}`;
            if(labaEl) labaEl.innerText = `Rp ${totalLaba.toLocaleString()}`;
        }

        function clearHistory() {
            if (confirm('Hapus semua riwayat transaksi?')) {
                transactions = [];
                localStorage.setItem('wa_tx', JSON.stringify(transactions));
                renderReports();
            }
        }
    </script>
</body>
</html>
